Every script is devided four stages, consisting of the same order as the corresponding flow of the paper. This file describes the functions of each script.
Before start, enter conda environment named "cibersort". (# conda activate cibersort)

1.	Clustering
Consensus clustering script was written in R, while K-means and hierarchical clustering were scripted in Python. “TCGA_CIBERSORT.txt” is loaded at “1_ConsensusClustering.ipynb” and the clustering result is saved as “CC_result.txt”. The result file is preprocessed by “2_IC_best_score.ipynb” into “itemConsensus_BS.txt”. “3_Km_Hier_clustering.ipynb” performs K-means/hierarchical clustering and merges all clustering results including the previous consensus clustering step with survival information from the clinical profile(“TCGA_clinical.txt”). Merged data is saved as “clustered_sample.txt”. “4_survival_R.ipynb” shows the Kaplan-Meier (K-M) plot of each clustering method’s result and prints its chi-square and corresponding p-value. “5_survival_python.ipynb” prints/saves the K-M plot of hierarchical clustering result, also focusing binary risk group as stated in the paper (Figure 2).

2.	Boxplot
“boxplot.ipynb” was scripted in Python. The script uses “CIBERSORT_clsadded.txt” as input which includes merged information of the CIBERSORT result and some parts of the “clustered_sample.txt” for convenience for various uses in further analyses. The same plot as Figure 3 in the paper is saved as “res.tiff”.

3.	Validation
This part contains Python scripts for the internal/external validation of the paper. “1_binary_classification.ipynb” uses “TCGA_trainingset.csv”(input format-preprocessed TCGA CIBERSORT result) as training set of our classifier. The dataset is split in a ratio of 8:1:1 and assigned as training set and primary/secondary testset respectively. The last accuracy of both testsets may be checked through the classifier.evaluate() function. In addition, during this step, graphs of the internal accuracy and corresponding loss graph are saved(Figure 4). For external validation, the risk group of the preprocessed ICGC cibersort result(“ORCA_testset.txt”) is predicted using the trained classifier. The result is saved as “CIBERSORT_prediction.txt”. Survival information from “donor.tsv” is merged with the prediction result into “clustered_sample.txt”. “3_survival_analysis.ipynb” provides a K-M plot of ICGC cohort and saves the plot in “survival.tiff”(Figure 5).

4.	DEG
R based “1_limma.ipynb” provides Differentially Expressed Gene(DEG)s between trained/predicted risk groups of TCGA and ICGC cohorts via the Limma package. The script loads each gene expression table and corresponding risk group information and performs DEG analysis between the high/low risk group of each. The result is saved in toptable format as “TCGA(ICGC)_Low_vs_High_risk.txt”. The result is separated into up/downregulation and individually saved with |logFC|>1.2 and p-value<0.05 thresholds applied via Python based “2_threshold.ipynb”. The script also outputs common DEGs between the two cohorts.

The entire pipeline may be run via a pre-established docker image: https://hub.docker.com/r/asdoper0630/cibersort_final. It contains every required/resulted i/o data, pipeline scripts, and required packages. For better effeciency, an identical docker image can be built via uploaded "Dockerfile" and uploaded scripts may be run at the container from the established image.
